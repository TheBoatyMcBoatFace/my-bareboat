Документация по операционной системе Bareboat Necessities
мгроуч
mgrouch@users.noreply.github.com
Версия 2021-12-13,
Документация по операционной системе Bareboat Necessities
Оглавление
1. Начало работы
1.1. Зачем использовать BBN OS?
1.1.1. Случаи применения
1.1.2. Умная лодка
1.2. Скачать изображение
1.2.1. 32-битные и 64-битные изображения
1.3. Подготовьте SD-карту
1.4. Первая загрузка с SD-карты
1.5. Настройка сети
1.5.1. Проводной Ethernet
1.5.2. Клиент Wi-Fi
1.5.3. Точка доступа Wi-Fi
1.5.4. Использование iPhone в качестве Интернет-шлюза
1.5.5. Использование телефона Android в качестве Интернет-шлюза
1.5.6. SpaceX Starlink
1.5.7. Типичная установка на лодке
1.6. Установить часовой пояс / языковой стандарт
1.7. Изменить пароль
1.8. Международная клавиатура
1.9. Загрузка SSD
1.10. Настроить GPS
1.11. Настроить АИС
1.12. Обновите плагины OpenCPN
1.13. Настроить диаграммы
1.13.1. OpenCPN
O-диаграммы
Создание собственных графиков MbTiles
1.13.2. AvNav
1.13.3. СигналК, FreeBoard-SK, ТукТук
1.14. Настройте параметры вашего корабля
1.15. SignalK
1.16. PyPilot
1.17. UI для управления автопилотами
1.18. Погода
1.18.1. ХОЧЕТ
1.18.2. NOAA погода в SignalK
1.18.3. WeatherFax
1.18.4. Маршрутизация погоды
1.19. WinLink (аналог SailMail) для Raspberry Pi
1.20. Музыкальные плееры
1.20.1. Музыкальная коробка
1.20.2. радужная оболочка
1.20.3. Воспроизведение с вашего iPhone (Spotify и т. Д.)
1.20.4. Игра с мобильных телефонов с приложениями MPD
1.20.5. Играю в Spotify
1.21. Взаимодействие с судовыми системами
1.21.1. NMEA 0183
1.21.2. NMEA 2000
1.21.3. ИДУ
1.21.4. Барометр / Температура / Влажность
1.21.5. Другой
1.22. Инструментальные панели
1.22.1. OpenCPN
1.22.2. KIP
1.23. Удаленный доступ
1.23.1. VNC
RealVNC с возможностью подключения к облаку
1.23.2. ssh
RaspController
1.23.3. Android-устройства
1.23.4. Браузеры
1.23.5. Трансляция из Chromium на телевизор
1.23.6. Приложения для смартфонов
1.24. Безголовый Операция
1.25. военно-морское радио
1.26. Иридиум Телефон
1.27. Камеры
1.27.1. IP камеры
1.27.2. Интерфейс камеры RPI
1.27.3. MotionEye
1.28. Круиз по стойке регистрации сотового телефона
1.29. Оффшорные возможности
1.30. Смотреть фильмы
1.31. Как это сделано
1.32. Завершение работы / перезагрузка
1.32.1. Безопасное отключение питания
1.33. Настройка рабочего стола
1.33.1. Настройка меню приложений
1.34. Настройка при первой загрузке
1.35. Известные проблемы и обходные пути
1.35.1. Сенсорный экран
1.35.2. Wi-Fi DNS
1.36. Дополнения
1.36.1. Текст в речь
1.36.2. Navionics
1.36.3. QtVlm
1.37. Порты по умолчанию
1.38. Брандмауэр
1.39. блютус
1.40. Amazon Alexa и т. Д.
1.41. QtVlm Chartplotter
1.42. Морская библиотека
1.43. Медиа библиотека
1,44. HomeAssistant
1.45. Предложения
1,46. Аппаратное обеспечение
1.47. Печать
1.48. Социальные сети и обмен сообщениями
1.49. Отправка геоданных
1.50. Самые полезные функции для средних коротких круизов
1.51. Интернет вещей
1.51.1. Сервер Mosquitto MQTT
1.51.2. УзелКрасный
1.52. Аналитика данных
1.52.1. Графана
1.52.2. InfluxDB
1.53. Потребляемая мощность
1.54. Обновление вашей системы
1.54.1. Проверенные обновления
1.54.2. Все прочие обновления
1.55. Поток данных
2. Поддерживаемое оборудование
2.1. Мониторы
2.1.1. Подключение мониторов
2.1.2. Яркость
2.2. Случай Rpi4
2.3. Решения на основе CM4
2.4. ИДУ, компас, акселерометр, гироскоп
2.5. Датчики окружающей среды
2.5.1. Барометр, датчики температуры и влажности I2C
2.6. АИС
2.7. Радары
2.8. USB-концентраторы
2.9. LTE / Wi-Fi роутеры
2.10. SD-карты
2.11. SeaTalk1
2.12. NMEA 0183
2.13. NMEA 2000
2.14. NMEA OneNet, PoE
2.15. GPS
2.16. SDR, SSB
2.17. SSD
2.18. NavTex
2.19. RTC (часы реального времени)
2.20. Звуковые карты
2.21. Камеры
2.21.1. IP камеры
2.21.2. Подключение камер к CSI на raspberry pi
2.21.3. Зрение при слабом освещении
Ночное видение FLIR
2.21.4. Камеры с подключением через USB
2.22. ESP32 / Ардуино
2.23. ESP32 с SignalK
2.24. 1-проводной
2.25. Интернет вещей
2.26. Преобразователи питания, 12в → 5в
2.26.1. Преобразователи постоянного напряжения
2.26.2. Управление питанием, Victron, Venus OS
2.27. Проекты открытых лодок
2.28. Антенны
2.28.1. УКВ, АИС
2.28.2. Wi-Fi, LTE / 4G
2.28.3. GPS
2.28.4. Спутниковые данные (Iridium, StarLink и т. Д.)
2.28.5. FM (частотная модуляция)
2.28.6. Bluetooth, 433 МГц FM RF
2.28.7. NavTex, WeatherFax
2.28.8. SSB, HAM
2.28.9. LoRa
3. Как вы можете помочь
4. HOWTO
4.1. BerryGPS-IMU V3
4.2. RTL8812AU драйверы
4.3. Облачное хранилище
4.4. Использование вашего смартфона в качестве приемника NMEA GPS
4.5. Как пользоваться смартфоном в качестве GPS-приемника и иметь доступ в Интернет на лодке в пределах сотовой связи
4.6. Настройка двух мониторов
4.7. Автозапуск программ при запуске рабочего стола
4.8. Работа с мониторами с более высоким разрешением
4.9. Сторожевая собака
4.10. Устранение неполадок / dev / ttyXXXX устройство или ресурс занят
​

Логотип Bareboat Necessities
​

https://bareboat-necessities.github.io

https://github.com/bareboat-necessities/lysmarine_gen

https://github.com/bareboat-necessities/lysmarine_gen/issues

https://bareboat-necessities.wixsite.com/my-bareboat

​

Версия PDF:

https://bareboat-necessities.github.io/my-bareboat/bareboat-os.pdf

​

1. Начало работы
1.1. Зачем использовать BBN OS?
Зачем использовать BBN OS? Кто-то использует на борту только коммерческую морскую электронику, кто-то использует смарт-планшеты и морские мультиплексоры Wi-Fi. Во всех этих решениях отсутствует один важный компонент - бортовой компьютер, способный отслеживать и контролировать все аспекты лодочных систем, а также хранить данные. Некоторые ставят за него компьютер на базе Intel. Решения на базе Intel более энергоемкие. С BBN OS вы можете построить центральный лодочный компьютер, отвечающий вашим потребностям. И все это на Raspberry Pi с низким энергопотреблением и гибкостью добавления бесчисленных датчиков для связи со всеми системами лодки, Интернетом, локальным Wi-Fi, камерами, сетью NMEA и системой, способной декодировать протоколы морской радиосвязи. BBN OS бесплатна и имеет открытый исходный код. Он основан на широко используемых проектах с открытым исходным кодом, поддерживаемых сообществом, таких как SignalK, PyPilot, OpenCPN и других.

1.1.1. Случаи применения
Картплоттер с сенсорным экраном в кабине

Навигационная станция Компьютер

Настольный компьютер

Ноутбук на базе Pi

Безголовый сервер

Медиа-плейер

Автопилот

SSB радиодекодер

Сервер морских данных, мультиплексор

Точка доступа Wi-Fi

Камеры Мониторинг

Сервер аналитики данных

Метеостанция

Панели управления лодкой

Файловый сервер

Жизнь вне сети

1.1.2. Умная лодка
Умная лодка
Рисунок 1. Схема умной лодки

Диаграмма имеет цветовую маркировку. Оранжевый указывает на то, что у вас (возможно) уже есть на вашей лодке. Желтые - дополнения. Зеленый - это Пи (центральный элемент).

​

1.2. Скачать изображение
Скачать образ SD-карты (файл размером ~ 3Гб):

https://github.com/bareboat-necessities/lysmarine_gen#download

Альтернативное место для скачивания, если предыдущая ссылка вам не подходит:

https://github.com/bareboat-necessities/lysmarine_gen/releases/tag/v2021-12-01

Прошлый выпуск LTS:

https://archive.org/details/lysmarine-bbn-linux-LTS4

1.2.1. 32-битные и 64-битные изображения
У каждого есть свои плюсы и минусы

32-битная версия требует меньше памяти, но работает медленнее

32-битная версия больше поддерживается на данный момент (некоторые камеры не поддерживаются в 64-битной версии на момент написания этой статьи)

QtVlm, wx2img, многие плагины OpenCPN являются только 32-битными (на момент написания этой статьи)

Вы по-прежнему можете запускать 64-битное ядро ​​с 32-битным образом, программы пользовательского пространства будут 32-битными. (Добавьте arm_64bit = 1 в /boot/config.txt)

32-разрядная версия доступна на большем количестве оборудования

64-битная ОС и OpenCPN работают нормально, но технически все еще называются бета-версией.

Большинство открытых (незначительных) проблем присутствует как в 32-битных, так и в 64-битных образах.

Переход с 32-битного ядра на 64-битное ядро ​​влияет на установку Java. См. (Обходной путь): https://github.com/bareboat-necessities/lysmarine_gen/issues/44
На момент написания этой статьи лучшая производительность / совместимость - это 32-битный образ с переключением ядра на 64-битный. Вашим предпочтительным образом загрузки BBN OS будет armhf.

Установить образ armhf

Переключение на 64-битное ядро ​​в /boot/config.txt уже сделано за вас в последних версиях BBN OS

Выполните все остальные шаги по настройке.

После установления подключения к Интернету установите официальные исправления (также необходимые для настройки сенсорного экрана):

cd /home/user/add-ons
./hot-fixes-install.sh
Перезагрузка (требуется одна перезагрузка после установки для получения всех настроек)

1.3. Подготовьте SD-карту
Запишите загруженный образ на SD-карту. Рекомендуется SD-карта объемом не менее 32 ГБ. Вы можете использовать Raspberry Pi Imager для этого:

https://www.raspberrypi.org/software/

Если разрешение вашего экрана ниже 1024x600, вам нужно будет вручную установить его в файле /boot/config.txt, установив / загрузочный раздел вашей SD-карты (в Windows это можно сделать, просто вставив его в слот для SD-карты и отредактировав в текстовый редактор).

Качество SD-карты важно для производительности вашей системы. BBN OS поставляется с инструментом тестирования дисков. Хорошая SD-карта будет показывать скорость ввода-вывода около 45 МБ / с (или выше). Диски SSD показали бы гораздо лучшие результаты: скорость ввода-вывода 178 МБ / с при чтении и 147 МБ / с при записи или выше.

1.4. Первая загрузка с SD-карты
Вставьте SD-карту в слот для SD-карты raspberry pi, подключите мышь и клавиатуру и включите питание. Подождите, пока процесс загрузки запустит графический интерфейс (около 2 минут).

Ваш сенсорный экран должен быть подключен (HDMI и USB) и включен во время первой загрузки, чтобы он был правильно распознан и откалиброван.
1.5. Настройка сети
1.5.1. Проводной Ethernet
Если у вас есть проводной Ethernet-маршрутизатор, вы можете просто подключить свой Ethernet-порт Raspberry Pi к маршрутизатору.

1.5.2. Клиент Wi-Fi
Зайдите в меню настроек сети и удалите точку беспроводного доступа Wi-Fi.

Вам необходимо настроить страну Wi-Fi.
Измените /etc/wpa_supplicant/wpa_supplicant.conf, чтобы добавить строку для вашей страны (пример):

country=US
Измените / etc / default / crda, чтобы указать вашу страну (пример):

REGDOMAIN=US
Когда карта Wi-Fi raspberry pi обнаруживает сеть вашего маршрутизатора Wi-Fi, нажмите, чтобы подключиться к Wi-Fi, и введите правильный пароль Wi-Fi.

Когда всплывает диспетчер хранилища паролей, чтобы ввести пароль для хранилища паролей, я обычно оставляю его пустым, поэтому мне больше не предлагается.

1.5.3. Точка доступа Wi-Fi
Соединения Wi-Fi управляются широко используемым Gnome NetworkManager. Ищите документацию по "nmcli" (интерфейс командной строки для NetworkManager). Или вы можете выяснить это из меню приложения Администрирование / Расширенные настройки сети. По умолчанию образ ОС настроен так, чтобы предоставить вам точку доступа.

1.5.4. Использование iPhone в качестве Интернет-шлюза
Включите персональную точку доступа на iphone. Подключите его к Pi с помощью ОС BBN через USB и скажите iPhone, чтобы он доверял подключенному компьютеру. У вас будет привязанное подключение к Интернету с вашего пи через iPhone (с помощью usbmuxd).

Вам не нужно подключаться к USB, если ваш телефон и лодочный компьютер находятся в одной локальной сети Wi-Fi.

1.5.5. Использование телефона Android в качестве Интернет-шлюза
Включите USB-модем в настройках сети на телефоне Android. Подключите его к лодочному компьютеру через USB.

Вывод команды ниже должен показать новый маршрут через интерфейс usb0:

netstat -nr
Вы также можете использовать модем через Wi-Fi вместо USB.

1.5.6. SpaceX Starlink
SpaceX Starlink Dishy скоро появится на лодках, и ее легко поддерживать. Для небольших лодок потребление энергии может быть относительно высоким.

1.5.7. Типичная установка на лодке
Raspberry Pi подключен к маршрутизатору OpenWrt LTE / 4G / WiFi через порт Ethernet

Raspberry Pi обеспечивает локальную точку доступа Wi-Fi 802.11ac 5 ГГц для локальной сети Wi-Fi на лодке

Маршрутизатор OpenWrt LTE / 4G / WiFi обеспечивает Wi-Fi подключение к пристани для яхт

Маршрутизатор OpenWrt LTE / 4G / WiFi обеспечивает доступ в Интернет через сотовую сеть передачи данных LTE / 4G

Маршрутизатор OpenWrt LTE / 4G / WiFi обеспечивает локальную точку доступа 2,4 ГГц (WiFi 802.11n) для лодочных устройств IoT

Маршрутизатор OpenWrt LTE / 4G / WiFi служит межсетевым экраном

Если вы используете raspberry pi WiFi, лучше отключить управление питанием WiFi:

sudo systemctl unmask wifi_powersave@off.service
sudo systemctl enable wifi_powersave@off.service
sudo systemctl start wifi_powersave@off.service
Важно защитить вашу установку от несанкционированного доступа из Интернета. Убедитесь, что вы разместили свой raspberry pi за маршрутизатором, который добавляет защиту брандмауэра. Также важно изменить пароли по умолчанию.
1.6. Установить часовой пояс / языковой стандарт
Откройте Терминал из графического интерфейса и в командной строке терминала:

cd ~/add-ons
./timezone-setup.sh
Для изменения языкового стандарта (например, на en_US.UTF-8):

sudo su
perl -pi -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/g' /etc/locale.gen
locale-gen en_US.UTF-8
update-locale en_US.UTF-8
1.7. Изменить пароль
Пароли пользователя и root по умолчанию - changeme. Вы можете изменить его до того, как ваш компьютер подключится к Интернету.

Откройте Терминал из графического интерфейса и в командной строке терминала:

cd ~/add-ons
./change-password.sh
Чтобы изменить пароль root:

sudo su
passwd
exit
1.8. Международная клавиатура
Раскладка клавиатуры контролируется предустановленным приложением ibus. Чтобы добавить язык:

ibus-setup
1.9. Загрузка SSD
Если у вас есть SSD-накопитель, и вы хотите загрузиться с него (что было бы лучше и значительно улучшило бы производительность системы), вы можете выполнить следующие шаги:

Образ ОС поставляется с предустановленной утилитой rpi-clone. Если у вас есть индивидуальный корпус для вашего raspberry pi (например, DeskPi Pro), вам потребуется установить драйверы поставщика для вашего корпуса в соответствии с инструкциями поставщика.

Откройте терминал из графического интерфейса, и ваша командная строка для rpi-clone должна выглядеть так (проверьте использование https://github.com/billw2/rpi-clone, поскольку для вашей конкретной настройки могут быть нюансы):

sudo rpi-clone sda
Следуйте подсказкам.

1.10. Настроить GPS
Подключите USB-мышь GPS, и ОС должна ее распознать. Проверять:

ls -l /dev/ttyLYS*
1.11. Настроить АИС
Подключите приемник dAISy AIS к USB, и ОС должна его распознать. Проверять:

ls -l /dev/ttyLYS*
1.12. Обновите плагины OpenCPN
Запустить OpenCPN

Перейдите в Инструменты / Параметры / Плагины.

Обновить каталог плагинов

Просматривайте список плагинов и обновляйте плагины, когда доступно обновление (по одному)

Из-за ошибки в OpenCPN https://github.com/bareboat-necessities/lysmarine_gen/issues/53 Обновление плагинов в системе, загруженной с ядром arm64, не работает, даже если пользовательское пространство - armhf. Как обходной путь: загрузитесь с ядром armhf, обновите все плагины и только потом переключитесь на ядро ​​arm64.
Документация по плагинам OpenCPN: https://rasbats.github.io/opencpn-plugins-manual/

1.13. Настроить диаграммы
Образ ОС поставляется с несколькими картплоттерами:

OpenCPN

AvNav

Надводный борт-СК

ТукТук

с обширным набором плагинов, а также просмотрщиками файлов погоды GRIB

XyGrib

1.13.1. OpenCPN
Запустите OpenCPN. Перейдите на вкладку Инструменты / Параметры / Графики / Загрузчик диаграмм.

Щелкните "Добавить каталог". Для США: щелкните USA NOAA & Inland Charts / ENC / By Region.

Выберите свой регион, нажмите (или коснитесь) «ОК»

Нажмите «Обновить» (чтобы обновить каталог).

Перейдите на вкладку "Загрузить диаграммы…".

Щелкните правой кнопкой мыши (или нажмите и удерживайте) в списке диаграмм

Нажмите "Выбрать все" во всплывающем меню.

Нажмите кнопку «Загрузить выбранные графики» и дождитесь ее завершения.

Нажмите кнопку "Применить"

Перейдите на вкладку "Файлы диаграмм".

Нажмите кнопку Prepare all ENC Charts.

По завершении нажмите кнопку «ОК».

O-Charts можно зарегистрировать с помощью предустановленных плагинов OpenCPN (в пользовательском пространстве arm32 обязательно обновляйте плагины онлайн из каталога OpenCPN) с помощью USB-ключа O-Charts или ключа.

O-диаграммы
O-Charts - это коммерческие диаграммы, совместимые с OpenCPN. См .: https://www.o-charts.org/

Создание собственных графиков MbTiles
Создание собственных графиков MbTiles с помощью SASPlanet: http://svocelot.com/Cruise_Info/Equipment/mbTiles.htm

1.13.2. AvNav
Когда вы находитесь в сети, растровые плитки МБ NOAA должны работать из коробки. O-Charts можно зарегистрировать с помощью плагина AvNav с USB-ключом или ключом O-Charts.

1.13.3. СигналК, FreeBoard-SK, ТукТук
Следуйте документации SignalK, чтобы установить для них автономные графики.

1.14. Настройте параметры вашего корабля
Не забудьте настроить параметры вашего корабля в приложениях SignalK и Vessel. Они могут пригодиться.

Также в плагине OpenCPN Polar выберите полярный файл для вашей лодки из ~ / Polars, / usr / share / opencpn / plugins / weather_routing_pi / data / polars / или создайте его из записей ваших прошлых путешествий. Он понадобится для погодных маршрутов и т. Д.

Поляры важны для плагинов Weather Routing и Dashboard Tactics.

1.15. SignalK
SignalK управляет собственными обновлениями. Войдите в приложение веб-интерфейса SignalK Marine Data Server и выполняйте обновления через его магазин приложений.

Для получения поддержки по SignalK посетите: https://signalk-dev.slack.com/

1.16. PyPilot
Запуск сервера PyPilot:

sudo systemctl enable pypilot@pypilot
sudo systemctl start pypilot@pypilot
Помимо официальной документации PyPilot, вы также найдете этот WiKi https://github.com/pypilot/workbook/wiki очень полезным.

1.17. UI для управления автопилотами
Есть три варианта:

Автопилотом NMEA 2000 можно управлять, добавив страницу автопилота на приборную панель SignalK KIP или (экспериментально) в плагине автопилота SignalK.

Автопилотами Raymarine Autohelm SeaTalk можно управлять с помощью подключаемого модуля SignalK. Этот пользовательский интерфейс работает как веб-приложение и использует файл cookie проверки подлинности из приложения SignalK nativefier, поэтому убедитесь, что вы вошли в систему (с параметром «запомнить меня») в приложении пользовательского интерфейса SignalK и установите для тайм-аута сеанса SignalK (в настройках безопасности SignalK) большое значение. В противном случае вы получите ошибки аутентификации, пытаясь управлять своим автопилотом во время круиза.

Плагины DIY PyPilot можно контролировать тремя способами: с помощью плагина OpenCPN, автономного приложения PyPilot UI или веб-приложения PyPilot.

1.18. Погода
Вы можете добавить приложение для рабочего стола «Погода волнистый попугай». К сожалению, это связано с фиксированным местоположением, которое подходит для дневного моряка, но не работает для других.

Моряки в открытом море или даже прибрежные круизеры должны сосредоточиться на использовании XyGrib и плагина GRIB для OpenCPN.

Для настоящих мореплавателей необходимы плагины для маршрутизации погоды OpenCPN Climatology и OpenCPN.

1.18.1. ХОЧЕТ
Запустите xyGrib. Выберите область на карте. Нажмите, чтобы скачать файл Гриба. Выберите модель атмосферы и модель волны. Выберите параметры ветра, порыва ветра в данных о поверхности и высоту волны в данных о волнах. Щелкните Загрузить.

Теперь вы можете наложить эти данные GRIB на график OpenCPN. Можно проиграть файл прогноза Гриба вперед. Включите плагин GRIB в OpenCPN. Щелкните плагин GRIB на панели инструментов плагина OpenCPN. Загрузите файл GRIB в OpenCPN. Смотрите данные о погоде, наложенные на вашу карту.

Плагин OpenCPN GRIB также может подготавливать запросы электронной почты SailDoc для файлов Grib. Вы можете хранить их и отправлять по электронной почте через Интернет (если у вас есть соединение) или использовать WinLink Pat (клиент WinLink: https://github.com/la5nta/pat/wiki ) через SSB-радио или с помощью JPSKMail.

1.18.2. NOAA погода в SignalK
SignalK поставляется с плагином погоды NOAA. После настройки погодные предупреждения будут отображаться на панели управления KIP.

1.18.3. WeatherFax
Плагин WeatherFax OpenCPN может загружать погодные факсы из Интернета, а также захватывать их с радио SSB через аудиовход. (Pi нужна звуковая карта с аудиовходом, потому что она продается без платы аудиовхода). Так же, как файлы GRIB, они могут накладываться на диаграммы.

1.18.4. Маршрутизация погоды
Плагин Weather routing OpenCPN может спланировать маршрут вашей поездки. Он использует полярную диаграмму вашей лодки, поэтому убедитесь, что вы построили ее заранее, используя плагин Polar, или загрузите его для своей лодки. Несколько мест для проверки:

SeaPilot https://www.seapilot.com/

ORC-данные https://github.com/jieter/orc-data

Вам также необходимо загрузить данные климатологии с помощью плагина климатологии OpenCPN и загрузить файл grib. Они также нужны и используются при построении метеорологических маршрутов. Ваш запрос на файл grib должен также запрашивать данные о приливах и течениях, чтобы они были учтены алгоритмами маршрутизации.

1.19. WinLink (аналог SailMail) для Raspberry Pi
Установить:

cd ~/add-ons
./winlink-pat-install.sh
Документация по настройке и использованию:

https://github.com/la5nta/pat/wiki https://getpat.io/

Серия видео: Winlink на Raspberry Pi https://www.youtube.com/playlist?list=PL1QTYT4Qo9cY98NFmxrTvtGyWI9pgxtFq

ARDOP для числа Пи: https://www.cantab.net/users/john.wiseman/Documents/ARDOPC.html

1.20. Музыкальные плееры
Образ ОС поставляется с Mopidy, сервером MPD, MusicBox, сервером Shairport-Sync (AirPlay). По умолчанию аудиовыход настроен на порт аудиоразъема.

1.20.1. Музыкальная коробка
Запустите веб-интерфейс MusicBox. Попробуйте предварительно настроенный плейлист или выполните поиск в Tune-In или на YouTube.

1.20.2. радужная оболочка
Iris - это проигрыватель, альтернативный MusicBox. Ирис также входит в образ ОС BBN.

1.20.3. Воспроизведение с вашего iPhone (Spotify и т. Д.)
Слушайте музыку на iPhone. Выберите AirPlay на своем iPhone и выполните трансляцию на «лизмариновую» цель трансляции (ваш телефон должен быть подключен к Wi-Fi с лизмариновой точкой доступа).

1.20.4. Игра с мобильных телефонов с приложениями MPD
Установите MPD-совместимый медиаплеер на свое мобильное устройство, и с него вы сможете управлять воспроизведением библиотеки Mopidy на своем raspberry pi.

1.20.5. Играю в Spotify
Запустите приложение Spotify на мобильном устройстве, подключенном к Wi-Fi на лодке. Выберите устройство Lysmarine в качестве цели, чтобы играть на вашем пи через raspotify. Вам необходимо иметь премиум-аккаунт Spotify.

1.21. Взаимодействие с судовыми системами
Первым местом, где нужно начать настройку лодочных интерфейсов, будет SignalK. SignalK поставляется с множеством плагинов для общения со многими лодочными устройствами с поддержкой различных протоколов.

1.21.1. NMEA 0183
Если вы используете последовательный порт FTDI USB для USB-накопителей, ОС должна сразу распознать их, и если они правильно подключены к устройствам NMEA (например, ветер / глубина / скорость / GPS), их показания должны автоматически отображаться на приборных панелях.

При подключении устройств NMEA 0183:

Передача (Tx) (+) должна подключаться к приему (Rx) (+)
Tx (-) должна подключаться к Rx (-)
Rx (+) должна подключаться к Tx (+)
Rx (-) должна подключаться к Передача (-)
В случае, если передающее устройство имеет Tx (-), но на принимающем устройстве нет соответствующего Rx (-), оставьте Tx (-) передающего устройства отключенным. Несоблюдение этого правила может повредить отправляющее устройство.

В случае, если на принимающем устройстве есть Rx (-), но на передающем устройстве нет соответствующего Tx (-), заземлите Rx (-).

1.21.2. NMEA 2000
Проверьте настройки плагина SignalK и документацию SignalK.

1.21.3. ИДУ
Проверьте настройки PyPilot и документацию PyPilot.

Общие шаги

включить i2c (Параметры интерфейса)

cd ~/add-ons
./os-settings.sh
Включить службу pypilot

sudo systemctl enable pypilot@pypilot
sudo systemctl start pypilot@pypilot
На этом этапе вы должны увидеть показания тангажа / крена и т. Д., А также магнитного курса в элементе управления pypilot. Что вам нужно будет откалибровать.

Запустите калибровку pypilot. Когда лодка выровнялась, нажмите «Уровень лодки». (Очевидно, что ваш IMU должен быть жестко прикреплен к лодке, а не просто висеть). Для магнитного направления: IMU не знает, как вы сориентировали его внутри (куда направлен лук), поэтому вам необходимо отрегулировать его, заполнив поле настройки магнитного направления.

Установите соединение PyPilot с SignalK (перезапустите PyPilot непосредственно перед тем, как это сделать, чтобы получить новый действительный запрос)

Перейдите в веб-интерфейс SignalK в качестве администратора и утвердите запрос доступа от PyPilot для доступа READ / WRITE.

Данные IMU должны начать поступать в SignalK

1.21.4. Барометр / Температура / Влажность
Проверьте настройки плагина SignalK и документацию SignalK.

Общие шаги:

включить i2c (Параметры интерфейса)

cd ~/add-ons
./os-settings.sh
Чтобы проверить, работает ли он:

lsmod | grep i2c-dev
i2cdetect 1
Войдите в SignalK Marine Data Server

Включите плагин датчика BMP или BME. Дайте ему правильный адрес i2c. Уменьшите время ожидания опроса до 20 секунд.

Измените «salon.inside» на «outside» (одно слово), чтобы OpenCPN отображал показания.

Перезагрузите сервер SignalK.

На этом этапе вы должны увидеть в своем фиде данных атмосферное давление и температуру (возможно, влажность).

1.21.5. Другой
Поддерживаются многие другие устройства (обычно через SignalK)

1.22. Инструментальные панели
1.22.1. OpenCPN
Включите плагин OpenCPN 'Dashboard', добавьте инструменты. Панели мониторинга закрепляются справа внизу холста OpenCPN.

1.22.2. KIP
Загрузите демо KIP. В настройках панели управления KIP измените URL-адрес на http: // localhost: 3000

Вам следует запросить регистрацию токена KIP в SignalK, затем войти в приложение SignalK и авторизовать его. После этого отредактируйте инструменты и раскладку в настройках панели управления KIP.

1.23. Удаленный доступ
1.23.1. VNC
Образ ОС BBN поставляется с предустановленным сервером RealVNC, готовым к использованию в локальной сети.

Вам необходимо изменить метод аутентификации или пароль пользователя unix по умолчанию перед подключением системы к Интернету.
Образ ОС также предоставляет клиентское приложение VNC.

RealVNC с возможностью подключения к облаку
Создайте учетную запись на сайте realvnc.com. Войдите с сервера RealVNC вашего Pi в облако realvnc.com, используя созданную вами учетную запись. Установите пароль на VNC-сервере вашего пи для подключения пользователей. Во время входа на сайт realvnc.com создайте команду и пригласите людей, которым вы хотите получить доступ к удаленному рабочему столу к вашему пи. Когда они примут ваше приглашение, сообщите им пароль для подключения к вашему локальному серверу VNC. Им нужно будет загрузить программу просмотра RealVNC (может быть для ПК, Linux, Mac и т. Д.) И следовать инструкциям в приглашении.

1.23.2. ssh
Образ ОС поставляется с включенным ssh. Вы можете войти в систему, используя ssh user: 'user'.

RaspController
RaspController доступен в Google Play для вашего телефона или планшета Android и в AppStore для мобильных устройств Apple. Это позволяет удаленно управлять вашим raspberry pi.

1.23.3. Android-устройства
Образ ОС поставляется с предустановленным и предварительно настроенным scrcpy. Вы можете просматривать свои устройства Android и управлять ими. Вам необходимо включить отладку по USB на вашем устройстве Android или следовать инструкциям, чтобы включить управление через Wi-Fi. См .: https://github.com/Genymobile/scrcpy. В большинстве случаев вам просто нужно включить отладку по USB на устройстве Android и подключить его (благодаря autoadb).

1.23.4. Браузеры
URL-адреса приложений на вашем лодочном компьютере:

http: // лизмарин: 8080 PyPilot

http: // лизмарин: 3000 SignalK

http: // лизмарин: 3000 / @ mxtommy / kip / KIP

http: // lysmarine: 3000 / @ signalk / signalk-node-red Красный узел

http: // lysmarine: 3000 / admin / # / e / _signalk_vesselpositions Позиции судов

http: // lysmarine: 3000 / tuktuk-chart-plotter / Картплоттер TukTuk

http: // lysmarine: 3000 / @ signalk / signalk-autopilot / SK Автопилот

http: // lysmarine: 3000 / @ signalk / freeboard-sk SK Надводный борт

http: // lysmarine: 8099 AvNav

http: // лизмарин: 6680 Mopidy

http: // лизмарин: 6680 / musicbox_webclient / Mopidy MusicBox

http: // лизмарин: 6680 / iris / Mopidy Iris

http: // lysmarine: 8765 Камеры MotionEye

Убедитесь, что ваш lysmarine-компьютер сопоставлен со статическим IP-адресом в вашей сети через сопоставление MAC-адресов на вашем маршрутизаторе.

1.23.5. Трансляция из Chromium на телевизор
Вы можете запустить Chromium и транслировать вкладку браузера или весь рабочий стол на свой смарт-телевизор по протоколу ChromeCast, используя опцию Cast в меню Chromium и выбрав соответствующий источник. Ваш телевизор и лодочный компьютер должны быть в одной сети (LAN или Wi-Fi).

1.23.6. Приложения для смартфонов
Существует множество приложений для смартфонов, которые принимают поток данных в реальном времени в формате NMEA с хоста вашего лодочного компьютера: lysmarine, порт: 10110.

Есть несколько, которые даже обнаруживают SignalK и используют протокол SignalK. Примеры: SignalK Monitor, SignalK.

Ваш телефон и лодочный компьютер должны быть в одной сети Wi-Fi.

1.24. Безголовый Операция
Можно отключить загрузку в графический интерфейс, запустив:

sudo raspi-config
и выбрав загрузку в консоль в разделе Параметры системы / Загрузка - Автоматический вход.

1.25. военно-морское радио
Образ ОС поставляется со многими радиоприложениями HAM, декодерами для многих морских сигналов и протоколов. Многие продукты SDR должны работать. Декодирование также возможно с использованием внешних приемников HAM, подключенных через порт ввода звука (требуется звуковая карта USB, поскольку у Raspberry Pi нет встроенного звукового входа). Для правильного приема необходимы соответствующие антенны.

Меню HAM Radio содержит несколько приложений, полезных, особенно для моряков в открытом море. Если у вас нет сотовой или спутниковой связи, у вас все еще есть SSB (и если вы установили его SDR) радио. Эти приложения позволят вам (с некоторыми навыками и настройками):

Получение прогнозов погоды через WinLink

Получать и декодировать WeatherFax, NavTex, NOAA и спутниковые изображения погоды, сообщения флота Inmarsat

Отправляйте и получайте электронные письма через WinLink (требуется наличие лицензии на радиолюбительскую службу HAM)

SDR может помочь вам в декодировании AIS и ADS-B (авиационный аналог AIS)

Управляйте своей установкой (SSB / SDR) с помощью raspberry pi и монитора

и больше

1.26. Иридиум Телефон
BBN OS поможет вам использовать Iridium Phone в качестве модема для доступа в Интернет с низкой пропускной способностью или для периодической отправки коротких пакетов данных с использованием специально написанного плагина SignalK.

1.27. Камеры
1.27.1. IP камеры
Должно быть легко интегрировать с помощью предустановленного VLC. См. URL в /var/www/bbn-launcher/constants.js

IP-камеры обычно имеют некоторую задержку при отображении видео.

1.27.2. Интерфейс камеры RPI
Чтобы включить интерфейс камеры на raspberry pi4, запустите:

sudo raspi-config
и включите там интерфейс камеры.

1.27.3. MotionEye
По умолчанию сервис motioneye установлен и включен. Отключить:

sudo systemctl disable motioneye
sudo systemctl stop motioneye
sudo systemctl status motioneye
Пользователь по умолчанию: admin

Пароль пуст.

1.28. Круиз по стойке регистрации сотового телефона
Добавление маршрутизатора OpenWrt LTE / 4G значительно улучшит подключение вашей лодки к миру у берега. Вам обязательно нужно сделать это, чтобы иметь доступ в Интернет с лодки.

Образ ОС предоставляет вам интернет-приложения для:

Электронное письмо

Чат

FB

YouTube

Браузер

Онлайн Погода

Он-лайн графики

Марина Бронирование

Парусное образование

смс

и многое другое

1.29. Оффшорные возможности
Для мореплавателей в образ ОС предварительно загружен ряд функций.

NavTex

Флот Инмарсат (прием сообщений)

Использование Iridium в качестве модема

WeatherFax

GRIB (может быть через SSB)

WinLink

Приложения SDR / HAM Radio

АИС

Маршрутизация погоды / климатология

Небесная навигация

Автопилот (PyPilot)

Спутниковая погода

Радары (поддерживается несколько)

Отправка геоданных

Они действительно требуют дополнительного оборудования, настройки и преданности делу.

1.30. Смотреть фильмы
Просмотр онлайн (или прослушивание) контента, защищенного авторским правом с предоплатой (Netflix, Amazon PrimeVideo, Google, Spotify и т. Д.) В веб-браузере, поскольку Chromium требует DRM-библиотек с закрытым исходным кодом. В версии ОС для arm32 вы можете установить ее из папки дополнений ~ / add-ons /, запустив:

./widevine-lib-install.sh
На момент написания эта процедура не работает на arm64. Он работает на arm32 и даже на arm32 с 64-битным ядром.
1.31. Как это сделано
Для тех, кому комфортно писать программное обеспечение, скрипты для создания этого образа хранятся в самом образе (для справки) в / install_scripts. Полный исходный код для создания образа доступен по адресу: https://github.com/bareboat-necessities/lysmarine_gen.

1.32. Завершение работы / перезагрузка
На рабочем столе щелкните значок «Команды». Вы увидите меню, из которого вы можете выполнить перезагрузку / выключение и многое другое.

1.32.1. Безопасное отключение питания
Raspberry Pi не имеет функции безопасного отключения питания. Т.е. не выполняет выключение ОС перед выключением кнопкой. Существует множество сторонних решений со шляпами raspberry pi или нестандартными корпусами. Убедитесь, что вы не забыли установить для них необходимое программное обеспечение согласно документации поставщика.

1.33. Настройка рабочего стола
Рабочий стол можно настроить, отредактировав файл JavaScript в / var / www / bbn-launcher.

Веб-клиент PyPilot лучше смотрится в темной коже. Переключитесь на темную тему, если это не было сделано за вас автоматически.

1.33.1. Настройка меню приложений
Меню приложений можно настроить, отредактировав gnome-applications.menu в ~ / .config / menus.

1.34. Настройка при первой загрузке
Вы можете добавить дополнительные настройки, которые будут выполняться при первой загрузке системы, установив образ ОС и отредактировав скрипт /boot/first-boot.sh. Этот сценарий, как следует из названия, выполняется только один раз при первой загрузке.

1.35. Известные проблемы и обходные пути
См. Https://github.com/bareboat-necessities/lysmarine_gen/issues

Если исправление GPS потеряно в OpenCPN, первым делом попробуйте перезапустить SignalK. Вы можете сделать это с сенсорного экрана через значок «Команды» на рабочем столе.

Не создавайте петель данных с вашими потоками данных между OpenCPN, AvNav, SignalK, GPSd, Kplex, PyPilot.

1.35.1. Сенсорный экран
Морская ОС Linux с открытым исходным кодом BBN для Raspberry Pi от Bareboat Necessities настроена для лучшей поддержки сенсорного экрана (из-за необходимости поддерживать картплоттер с сенсорным экраном в кабине).

Поддерживаются экранная клавиатура, масштабирование двумя пальцами, долгое касание, касание двумя пальцами, прокрутка тремя пальцами. Нет вращения пальца (пока), копирование / вставка осуществляется через экранную клавиатуру.

Иногда возникают проблемы с синхронизацией при инициализации USB-портов во время первой загрузки. Если вы видите, что сенсорный экран не калибруется, попробуйте (после подключения к Интернету и правильно подключенного сенсорного экрана):

cd /home/user/add-ons
./hot-fixes-install.sh
Используйте ту же процедуру, если вы меняете сенсорный экран на другой.

Упомянутые ниже проблемы с сенсорным экраном исправлены с момента выпуска 2021-09-10.
Некоторые приложения (а именно на базе OpenCPN и gtk2, а также некоторые Qt) иногда перестают реагировать на события касания. Есть обходной путь. Пальцем вы можете переключать развернутый режим с помощью значка оконной рамки, затем ПЕРЕМЕЩАТЬ рамку окна, перетаскивая заголовок окна на несколько пикселей, и при необходимости переключаться обратно в развернутый режим. Это должно восстановить события касания в этом приложении.

В некоторых меню приложений gtk3 (например, терминал) есть проблемы с обработкой событий касания. Вы можете выбрать пункт меню касанием, но для того, чтобы щелкнуть по нему, вам действительно нужно будет смоделировать щелчок правой кнопкой мыши, удерживая палец немного дольше и отпуская его.

1.35.2. Wi-Fi DNS
Если вы используете свои устройства в сетях LAN или WiFi, им могут назначаться разные IP-адреса от серверов DHCP. Однако DNS-серверы имеют тенденцию кэшировать (запоминать) сопоставления имен с IP-адресами в течение некоторого времени. Таким образом, вы можете столкнуться с проблемами разрешения имен DNS, если вы не настроите DHCP-серверы для назначения согласованных IP-адресов (например, по MAC-адресу) всем вашим устройствам.

Другая ситуация, которая может вызвать проблемы с разрешением имен в DNS, - это когда одно устройство настроено на возможность выбора нескольких сетей Wi-Fi для подключения.

1.36. Дополнения
Проверьте каталог / home / user / add-ons. Он содержит ряд скриптов для установки множества дополнительных программ, которые по тем или иным причинам не могли быть частью образа дистрибутива.

Несколько примечательных дополнений:

1.36.1. Текст в речь
cd /home/user/add-ons
./text-to-speech-install.sh
1.36.2. Navionics
cd /home/user/add-ons
./navionics-demo-install.sh
1.36.3. QtVlm
cd /home/user/add-ons
./qtvlm-install.sh
1.37. Порты по умолчанию
Видеть:

sudo netstat -tulpen
Proto  Port       Transport            Program/Service
tcp    22         ssh                  sshd Secure Remote Shell
tcp    25         smtp                 exim4 e-mail
tcp    139        netbios              smbd
tcp    445        smb                  smbd
tcp    631        CUPS                 cupsd Printing
tcp    2947       gpsd                 gpsd
tcp    3000       http/WS              SignalK
tcp    4713       pulseaudio           pulseaudio audio
tcp    4997       http                 bbn-desktop
tcp    5000       airplay              shairport-sync music
tcp    5037       adb                  android adb
tcp    5900       vnc                  x11vnc
tcp    6600       mpd                  Mopidy MPD Music
tcp    6680       http                 Mopidy Music
tcp    8080       http                 PyPilot_web
tcp    8082       http                 AvNav Ocharts
tcp    8085       http                 AvNav Updater
tcp    8099       http                 AvNav
tcp    8375       http/json            SignalK Deltas
tcp    8765       http                 motioneye
tcp    10110      NMEA 0183            SignalK
tcp    20220      NMEA 0183            PyPilot
tcp    23322      json                 PyPilot
tcp    34567      NMEA 0183            AvNav NMEA out
tcp    dynamic    spotify              librespot
udp    68         DHCP                 dhclient
udp    137        nmb                  nmbd
udp    138        nmb                  nmbd
udp    323        ntp                  chronyd time service
udp    631        IPP                  CUPS Internet Printing Protocol
udp    5353       service discovery    avahi-daemon, chromium, others (bonjour, zeroconf, mDNS)
udp    10116      NMEA 0183            AvNav, KPlex
1.38. Брандмауэр
Начиная с версии ОС BBN 2021-10-02, в вашей системе будет работать межсетевой экран, и он включен по умолчанию. Правила брандмауэра по умолчанию:

sudo ufw status

Status: active

To                         Action      From
--                         ------      ----
Anywhere                   ALLOW       192.168.0.0/16
Anywhere                   ALLOW       169.254.0.0/16
Anywhere                   ALLOW       10.0.0.0/8
Anywhere                   ALLOW       100.64.0.0/10
Anywhere                   ALLOW       172.16.0.0/12
Anywhere                   ALLOW       224.0.0.0/4/udp
Anywhere on can0           ALLOW       Anywhere
Anywhere (v6)              ALLOW       fd00::/8
Anywhere (v6)              ALLOW       fe80::/10
Anywhere (v6)              ALLOW       ff00::/8/udp
Anywhere (v6) on can0      ALLOW       Anywhere (v6)
1.39. блютус
По состоянию на 2021-10-04 Bluetooth подходит только для низкоскоростных устройств. Вероятно, вы пропустите воспроизведение музыки через встроенный Pi bluetooth.

В версиях 2021-11-29 и более поздних эта проблема исправлена.
1.40. Amazon Alexa и т. Д.
Настройте его на использование Wi-Fi на вашей лодке. Вы также можете соединить его со своим пи через Bluetooth и воспроизводить музыку через Amazon EchoDot и т. Д. Mopidy, похоже, требует перезапуска, чтобы переключиться на воспроизведение через Bluetooth.

1.41. QtVlm Chartplotter
QtVlm можно установить через надстройки:

cd /home/user/add-ons
./qtvlm-install.sh
1.42. Морская библиотека
Вы можете установить свою бортовую библиотеку морских публикаций с помощью надстроек:

cd /home/user/add-ons
./maritime-lib-install.sh
1.43. Медиа библиотека
Вы можете установить JellyFin через надстройки:

cd /home/user/add-ons
./jellyfin-install.sh
1,44. HomeAssistant
Вы можете установить HomeAssistant (для многих пользователей BBN их лодка - их дом) через надстройки:

cd /home/user/add-ons
./homeassistant-install.sh
1.45. Предложения
Прелесть Linux в том, что вы можете настраивать его в соответствии с вашими потребностями бесконечным количеством способов. Хотя этот дистрибутив был нацелен на удовлетворение общих потребностей, вы обнаружите, что потребуется некоторое количество шагов настройки после установки. Ключ в том, чтобы записать эти шаги, сделать их неинтерактивными, не требуя графического интерфейса. В этом случае ваша установка становится ВОСПРОИЗВОДИМЫМ в случае выпуска новых образов ОС. Вы можете поделиться своими сценариями после установки, чтобы систему можно было улучшить и еще точнее настроить.

Хотя система поддерживает сенсорные экраны на этапе настройки, вы все равно захотите подключить к ней обычную проводную клавиатуру и мышь, поскольку в командной строке оболочки задействовано множество действий.

Для установки системы не обязательно быть инженером-программистом. Механик, электрик, помощник юриста, инженер-строитель, финансовый менеджер - вот несколько примеров людей с разным опытом, которые смогли установить и настроить его для своих лодок.

1,46. Аппаратное обеспечение
Это не первая моя сборка лодочного компьютера с Raspberry Pi. Многие идеи можно почерпнуть из моей более ранней сборки (сборка 2020 года, основанная на OpenPlotter). Для актуальной сборки я бы изменил несколько вещей:

Вместо дорогого Argonaut M7 я бы использовал (модель: SL07W, бренд Sihovision, емкостный сенсорный экран 7 дюймов, (1000 нит), IP65, 1024x600, стоимость менее 300 долларов): https://www.sihovision.com/industrial- сенсорный монитор / 7-дюймовый-промышленного-широкого-temperaturer-lcd-monitor-with-remote-control-1.html

Моя техника гидроизоляции была бы дешевле и лучше. Вместо дорогостоящих разъемов на задней панели компьютера (даже если он находится под палубой) я бы использовал водонепроницаемые сальники для выходов из корпуса и разъемов для пигтейлов. Я бы прикрыл точку подключения термоусадочной трубкой.

Я бы использовал какое-то безопасное решение для отключения питания и SSD вместо SD-карты. SSD дает ОГРОМНЫЙ прирост производительности.

Я бы использовал этот образ ОС (вместо образа OpenPlotter)

dAISy AIS - лучшее решение, чем SDR

Используйте концентратор USB 2.0, если USB 3.0 не требуется

Для более старых аппаратных решений (многие из них все еще действительны) см .:

https://bareboat-necessities.github.io/my-bareboat/

1.47. Печать
Печать из Chromium немного неудобна. Вам нужно выбрать меню «Печать», затем прокрутить вниз и выбрать «Дополнительные настройки» и выбрать «Печать с использованием системного диалогового окна», что позволит вам выбрать принтер.

1.48. Социальные сети и обмен сообщениями
BBN OS имеет несколько программ, которые помогут вам оставаться на связи с друзьями через социальные сети и приложения для обмена сообщениями через Интернет.

1.49. Отправка геоданных
SignalK поставляется с предустановленным плагином для saillogger.com

1.50. Самые полезные функции для средних коротких круизов
Off-line карты GPS, OpenCPN для вашего района плавания

ИДУ Компас

Приливы / течения в OpenCPN

Путевые точки, маршруты в OpenCPN, отслеживание

AIS в OpenCPN

Weather Windy и т. Д. При использовании Интернета LTE

Музыкальные плееры

Панели управления: ветер, скорость, глубина, GPS, местный закат и т. Д.

Барограф

Автопилот (при наличии)

Камеры для стыковки и ночника

Местная точка доступа Wi-Fi на лодке и шлюз LTE

1.51. Интернет вещей
1.51.1. Сервер Mosquitto MQTT
Образ ОС BBN поставляется с предустановленными, но отключенными клиентами Mosquitto и сервером. Чтобы включить и запустить его:

Включите и запустите сервер Mosquitto (по умолчанию порт 1883)

sudo systemctl enable mosquitto
sudo systemctl start mosquitto
Подпишитесь на темы

mosquitto_sub -t '#'
Опубликовать из SignalK: включить плагин MQTT Gateway. Выберите «Отправить данные на удаленный сервер» с URL-адресом mqtt: // localhost. Добавьте тему (например, navigation.headingMintage). Перезапустите SignalK и наблюдайте за потоком данных в подписчике.

1.51.2. УзелКрасный
NodeRed установлен в SignalK. Чтобы использовать NodeRed, войдите в SignalK, посетив http: // localhost: 3000, нажав «Войти», выбрав сеанс «запомнить меня» и сохранив пароль в браузере.

1.52. Аналитика данных
1.52.1. Графана
Образ ОС BBN поставляется с предустановленной, но отключенной графаной. Чтобы включить и запустить его:

Отредактируйте файл /etc/grafana/grafana.ini и измените строку '; http_port = 3000' на 'http_port = 3080' (чтобы избежать конфликта с SignalK)

sudo nano /etc/grafana/grafana.ini
Включите и запустите сервер Grafana

sudo systemctl enable grafana-server
sudo systemctl start grafana-server
Войдите в http: // localhost: 3080 с пользователем и паролем admin.

1.52.2. InfluxDB
Включите и запустите сервер InfluxDB (по умолчанию порты 8086 (клиент-сервер), 8088 (RPC))

sudo systemctl unmask influxdb.service
sudo systemctl enable influxdb
sudo systemctl start influxdb
Инициализировать базу данных и подключиться к ней (например) из плагина барографа SignalK.

Chronograf и Kapasitor также предустановлены.

1.53. Потребляемая мощность
С Raspberry Pi4 потребляемая мощность вашей системы должна быть около 4,5 Вт без монитора. Монитор, в зависимости от его размера и яркости подсветки (необходимой для читаемости при солнечном свете), может добавить еще 5 Вт или даже больше. Для сравнения, человеческий мозг потребляет около 12-25 Вт.

1.54. Обновление вашей системы
1.54.1. Проверенные обновления
Исправления, проверенные командой разработчиков, можно установить, запустив:

cd /home/user/add-ons
./hot-fixes-install.sh
1.54.2. Все прочие обновления
Ваши системные пакеты можно обновить, следуя стандартной процедуре системы упаковки Debian:

sudo apt update
sudo apt upgrade
Сервер и модули SignalK можно обновить с помощью SignalK App Store.

Графики OpenCPN можно обновлять с помощью плагина загрузчика диаграмм OpenCPN.

В результате обновления программного обеспечения вы можете получить конфигурацию, которая ранее не тестировалась. Хотя вы можете получить некоторую поддержку на форумах сообщества по адресу: https://github.com/bareboat-necessities/lysmarine_gen/discussions
1.55. Поток данных
Поток данных
Рисунок 2. Поток данных
​
​

2. Поддерживаемое оборудование
2.1. Мониторы
Для кабинного монитора многие люди не используют специальные судовые мониторы. Если на столе навигационной станции достаточно места для клавиатуры и мыши, вы можете подумать о приобретении экрана без сенсорной функции.

Для дисплея в кабине требуется яркость> 1000 нит для удобочитаемости при солнечном свете, водонепроницаемый, сенсорный экран с доступными кнопками управления подсветкой (яркостью) для ночного плавания. Вам потребуются длинные кабели HDMI и USB (для сенсорного ввода) для подключения к Raspberry Pi под палубой. Для этого есть даже оптоволоконные решения. Они позволяют использовать более тонкие кабели (за дополнительную плату). Бонус, если на вашем сенсорном дисплее есть встроенные динамики для будильника. Проверьте линейку продуктов Sihovision, если один из их продуктов вам подойдет. Некоторые примеры:

SL7W 7 дюймов https://www.alibaba.com/product-detail/sunlight-readable-7-inch-touchscreen-waterproof_60543830769.html

SL10W 10 " https://www.alibaba.com/product-detail/Outdoor-display-9-7-inch-IPS_1600251157854.html

SL12W 12 " https://www.alibaba.com/product-detail/daylight-viewable-monitor-ip67-touch-marine_60718449450.html

SL113 13 " https://www.alibaba.com/product-detail/Marine-displays-IP67-waterproof-13-3_62066633231.html

SL100W 10 " https://www.sihovision.com/full-ip65-high-brightness-touch-monitor/waterproof-monitor-sl100w.html

Выберите экран HDMI вместо DSI, поскольку они не требуют дополнительных контактов GPIO, на которые у вас могут быть другие планы. Большинство сенсорных экранов в настоящее время будут иметь емкостной мультитач из-за большей прочности и четкости.

2.1.1. Подключение мониторов
Вместо того, чтобы прокладывать длинные кабели USB и HDMI от кабины до лодочного компьютера под палубой, вы можете использовать удлинитель HDMI USB через Cat6 Ethernet. Учитывая высокую стоимость более длинных кабелей USB и HDMI, это решение может быть в целом даже дешевле. Кроме того, вместо двух толстых кабелей вам нужно будет проложить только один, более тонкий кабель Ethernet Cat6. Однако дважды проверьте у поставщика, поддерживает ли повторитель сенсорный экран через USB.

Это также может сработать для настройки двойных (зеркальных) мониторов.

2.1.2. Яркость
Светодиод - ЖК-дисплей со светодиодной подсветкой. IPS (переключение в плоскости) - это тип светодиода с лучшим качеством изображения и большей потребляемой мощностью, чем ЖК-дисплей на тонкопленочных транзисторах (TFT). OLED не имеет подсветки.

Читаемость при солнечном свете> = 1000 нит.

Программное управление яркостью возможно на мониторах, которые поддерживают DDC / CI (Display Data Channel) с raspberry pi через программу ddcutil. Он работает как канал i2c через HDMI.

Программное управление яркостью также возможно с мониторами, которые создают запись в / sys / class / backlight / <entry> на raspberry pi. В таких случаях можно использовать утилиту xbacklight для управления яркостью подсветки.

Выбирайте мониторы с потреблением менее 1 Вт на один диагональный дюйм.

2.2. Случай Rpi4
DeskPi Pro v2 - хороший корпус для Raspberry Pi4 под палубой с быстрым интерфейсом SSD и входом 12 В.

https://github.com/DeskPi-Team/deskpi

Advantech Uno 220 для Raspberry Pi4 выглядит неплохо, но не поддерживает SSD.

2.3. Решения на основе CM4
Одной из многообещающих плат и компьютеров CM4 является мини-компьютер Waveshare Industrial IoT на базе Raspberry Pi Compute Module 4:

https://www.waveshare.com/product/raspberry-pi/boards-kits/compute-module-4-cat/cm4-io-poe-4g-box.htm

Похоже, это может быть гораздо лучшая база для лодочного компьютера, чем просто Raspberry Pi4.

Он включает (и многое другое):

Потребляемая мощность 12 В (7-36 В)

Слот PCIe

Внешние антенны подключаются к порту антенны Wi-Fi CM4 и к порту антенны GPS или LTE на модеме LTE

CanBus (для NMEA 2000)

RS-485 (для NMEA 0183)

GPIO выставлен через заголовок с винтами

Интерфейс АЦП

I2C интерфейс

Часы RTC с местом для батареи

Слот для SIM-карты на панели

Полноразмерные двойные порты HDMI и два порта DSI

Корпус с винтовым креплением

Двойные входы камеры (CSI)

USB-порты

USB TO UART, для последовательной отладки

Один порт Gigabit Ethernet с включенным PoE

Больше индикаторов состояния

Слот для SD-карты на панели (для CM4 без eMMC)

Порт RS-232

Слот для модема LTE

Слот программирования

Зуммер

Или мини-компьютер Waveshare на базе вычислительного модуля Raspberry Pi 4, Mini IO Board версии B

https://www.waveshare.com/product/raspberry-pi/boards-kits/compute-module-4-cat/cm4-io-base-box-b.htm

с местом для SSD.

Другой вариант - плата и корпус от McuZone. Плюс в том, что в нем нет движущихся частей (только радиатор охлаждения).

Список досок: https://pipci.jeffgeerling.com/boards_cm.html

Некоторые из этих продуктов могут быть интересны для применения на лодках:

Бортовой компьютер Waveshare Mini IO (версия B): https://www.waveshare.com/product/cm4-io-base-box-b.htm

Компьютер Waveshare IoT CM4 https://www.waveshare.com/product/raspberry-pi/boards-kits/compute-module-4-cat/cm4-io-poe-4g-box.htm

Компьютеры MCUzone Carrier Grade CM4 (безвентиляторные) https://www.aliexpress.com/item/1005001972265702.html

Промышленный компьютер EDATEC CM4 https://www.edatec.cn/en/Product/Camera_Modules/2019/0826/76.html

Если вы используете плату Waveshare и ваш модуль CM4 поставляется с eMMC, вы не сможете загрузить его с SD-карты, и вам придется записать eMMC. Чтобы записать eMMC в Windows, вам необходимо установить последнюю версию rpiboot_setup.exe из проекта usbboot на github. Вам нужно будет переключить перемычки (переключатели) на вашей плате, чтобы использовать ведомый USB-кабель OTG, чтобы иметь возможность записать eMMC. Это медленный процесс, так как он выполняется через интерфейс USB 2.0. Более того, в стандартном образе ОС Raspberry Pi не будут включены USB-порты Waveshare. Поэтому перед записью образа в eMMC вам необходимо изменить его и добавить строку dtoverlay = dwc2, dr_mode = host в /boot/config.txt на образе. По этой (и другим) причинам в ОС BBN есть отдельный образ для поддержки платы Waveshare. Образ основан на базовом образе ОС BBN с дополнительными настройками для поддержки платы Waveshare.
2.4. ИДУ, компас, акселерометр, гироскоп
PyPilot поддерживает их через RTIMULib2. Вот список модулей, поддерживаемых RTIMULib2:

InvenSense MPU-9150

InvenSense MPU-9250

InvenSense MPU-9255

СТМ LSM6DS33 / LIS3MDL

СТМ L3GD20H / LSM303D

СТМ L3GD20 / LSM303DLHC

СТМ LSM9DS0

СТМ LSM9DS1

СТМ LSM6DSL

InvenSense ICM-20948

Honeywell HMC5883L с ADXL345 и L3G4200D

STM ISM330DHCX

Bosch BMX055 (экспериментальный штатив для магнитометра)

Bosch BNO055 (не работает надежно на Pi, проблемы с часами)

Документация PyPilot рекомендует использовать IMU 9 степеней свободы с mpu9255.

Даже без контроллера мотора автопилота эти датчики позволяют отображать крен, тангаж и рыскание.

2.5. Датчики окружающей среды
2.5.1. Барометр, датчики температуры и влажности I2C
Они обрабатываются плагинами Signal-K. Поддерживаемые:

Bosch BME280

Bosch BME680

В SignalK есть также плагин барографа.

2.6. АИС
Есть несколько вариантов:

Если у вас есть датчик AIS, вы просто используете его через шину NMEA.

AIS, встроенный в мультиплексор NMEA, используемый через сеть NMEA

dAISy USB AIS или Raspberry Pi dAISy AIS Hat. USB-порт проще настроить.

Декодируйте радиосигналы AIS с помощью SDR. Вероятно, это худший вариант, поскольку SDR требует значительных затрат энергии для постоянного выполнения этой задачи.

Открытый исходный код (приемник / преобразователь): https://github.com/peterantypas/maiana

2.7. Радары
Плагин OpenCPN Radar сообщает о поддержке следующих радаров:

Navico / B&G / Lowrance / Simrad: BR24, 3G, 4G и HALO20, 20+, 24, 4, 6 и 8

Garmin: HD и xHD

Raymarine: Ethernet-аналог: RD218, RD418 / Ethernet-цифровой: RD418D, RD424D

Радары Quantum / Quantum2 от Raymarine, похоже, не поддерживаются OpenCPN, как и радары Garmin Fantom или устройства Furuno.

У нас не было оборудования для всего этого, поэтому сообщения об успешных установках и обнаруженных проблемах приветствуются.

2.8. USB-концентраторы
Выберите USB-концентратор с питанием, который не обеспечивает обратную подачу питания на pi4, чтобы избежать проблем, связанных с невозможностью перезагрузки pi4, когда USB-концентратор все еще включен.

Если вы не планируете подключать к USB-концентратору устройства хранения данных, камеры, сетевые карты (высокоскоростные устройства), то концентратор USB 2.0 выполнит эту работу. Нет необходимости в концентраторе USB 3.0.

USB-порты соответствуют цветовому соглашению:

Тип	Цвет
USB 1.0

белый

USB 2.0

Чернить

USB 3.0

Синий

USB 3.1

Бирюзовый

Зарядка и спящий режим или высокий ток

Желтый

красный

апельсин

Хаб, который нам нравится: https://www.amazon.com/dp/B07BBLL3MJ/ Aiibe 6 Ports Super High Speed ​​USB 3.0 Hub Splitter

2.9. LTE / Wi-Fi роутеры
Нужный Wi-Fi роутер несколько отличается от вашего домашнего роутера. Ваш домашний маршрутизатор подключается к WAN через Интернет и предоставляет вам локальный Wi-Fi. На лодке ситуация обратная. Ваш WAN - это Wi-Fi на пристани, и ваш Pi (желательно) должен быть подключен к маршрутизатору. Эти маршрутизаторы Wi-Fi продаются как маршрутизаторы Wi-Fi для путешествий. Не все дешевые маршрутизаторы Wi-Fi дадут вам возможность подключиться к Wi-Fi на пристани и поделиться им на лодке. Лучше выбирать те, которые работают под управлением операционной системы OpenWrt, которая основана на Unix и имеет открытый исходный код. LTE - очень ценная функция.

Несколько рекомендуемых: GL.iNet (GL-X750 V2) Spitz router, Teltonika RUTX12 (две SIM-карты).

Также следует учитывать: Компактный промышленный маршрутизатор InHand Networks IR300, Промышленный маршрутизатор YeaComm или открытый LTE-маршрутизатор YeaComm.

2.10. SD-карты
В SD-карте вы будете обращать внимание на скорость (чтение / запись, запись в / в), долговечность, размер. > Рекомендуется 32Гб.

2.11. SeaTalk1
SeaTalk1 - это собственный протокол Raymarine. Многие популярные автопилоты Autohelm Raymarine используют его. SeaTalk1, в отличие от NMEA 0183, - это шина, позволяющая использовать несколько говорящих и несколько слушателей на одной и той же шине. Чтобы интегрировать его в вашу систему, у вас есть несколько вариантов:

Используйте двунаправленный мультиплексор NMEA 0183, который поддерживает один порт SeaTalk1. Первыми проверили компании YakBitz и Quark-elec Marine. Есть и другие. Вы хотите, чтобы двунаправленный мультиплексор мог управлять автопилотом с вашего пи через NMEA. В SignalK есть специальный плагин для автопилота Autohelm.

Купите специальный конвертер Seatalk1 в NMEA.

Для соединения Seatalk1 только для чтения вы можете использовать это решение: https://github.com/SignalK/signalk-server/blob/master/Seatalk(GPIO).md

SeaTalk1 был реконструирован, и преобразователь в NMEA доступен по адресу: https://github.com/MatsA/seatalk1-to-NMEA0183

https://github.com/Thomas-GeDaD/Seatalk1-Raspi-reader

2.12. NMEA 0183
Широко поддерживается. Множество вариантов подключения к пи.

USB / последовательный порт:

с чипсетом FTDI FT232 https://www.amazon.com/dp/B07B416CPK

с чипсетом CP210x преобразователь RS422 в USB

с чипсетом CH340 преобразователь RS422 в USB

с набором микросхем Prolific PL2303, преобразователь RS422 в USB

Мультиплексоры NMEA 0183, работающие через USB (YakBitz, Quark-elec и т. Д.)

FTDI - предпочтительный выбор между FTDI, CP210x, CH340 или PL2303. Кажется, что FTDI всегда имеет уникальный серийный идентификатор, который может отсутствовать на других, и будет сложнее написать правила udev для уникального имени устройства на шине USB.
Доска:

PiCAN-M Raspberry Pi Hat от https://www.skpang.co.uk

Sailor Hat для Raspberry Pi от https://hatlabs.fi

GeDaD MCS, Серверная плата морского управления, https://www.gedad.de/

TCP / IP:

Мультиплексоры NMEA 0183, работающие через Wi-Fi или Ethernet

Продавцы:

ЯкБитц http://www.yakbitz.com/

Quark-elec https://www.quark-elec.com/

OceNav https://ocenav.com/

ShipModul http://www.shipmodul.com/

Яхтенные устройства https://www.yachtd.com/

DigitalYacht https://digitalyachtamerica.com/

Actisense https://actisense.com/

NoLand Engineering https://nolandeng.com/

Veinland https://veinland.net/

Зиннос http://zinnos.com/

Маретрон https://www.maretron.com/

Закодированные решения https://www.encodedsolutions.com/

Comar Systems https://comarsystems.com/

gadgetpool.de https://www.gadgetpool.eu/

Отслеживание звезд https://www.star-tracking.com/

2.13. NMEA 2000
Протокол NMEA 2000 был реконструирован в рамках этого проекта: https://github.com/canboat/canboat

С тех пор протокол NMEA 2000 был встроен в SignalK.

Варианты подключения Pi к шине NMEA 2000:

Платы / шляпы для печатных плат:

PiCAN-M Raspberry Pi Hat от https://www.skpang.co.uk

Sailor Hat для Raspberry Pi от https://hatlabs.fi

GeDaD MCS, Серверная плата морского управления, https://www.gedad.de/

USB / последовательный порт:

Actisense NGT-1 NMEA 2000® на ПК https://actisense.com/products/ngt-1-nmea-2000-to-pc-interface/

CANable и CANable Pro от https://canable.io/

Конвертер iKonvert NMEA 2000-USB

ShipModul MiniPlex-3USB-N2K

Устройства для яхт NMEA 2000 USB-шлюз YDNU-02

Шлюзы TCP / IP:

Двунаправленный мультиплексор NMEA 2000 WiFi (Quark-elec и т. Д.)

ShipModul MiniPlex-3E-N2K

Устройства на яхте Шлюз Wi-Fi NMEA 2000 YDWG-02

Устройства для яхт NMEA 2000 Ethernet-шлюз YDEN-02

NavLink2 digitalyachtamerica.com

Плагин OpenCPN TwoCan также имеет список совместимых с ним устройств.

Держитесь подальше от устройств, которые просто конвертируют NMEA 2000 в NMEA 0183. Вам нужно передать NMEA 2000 в SignalK и иметь возможность принимать его.

2.14. NMEA OneNet, PoE
NMEA OneNet основан на сети Ethernet с 8-контактными разъемами RJ-45 или X-Coded M12 (для прохождения небольших отверстий).

PoE (Power over Ethernet) позволяет подключать устройства к одним и тем же кабелям для передачи данных. Это хороший способ сократить количество кабелей в вашей системе.

2.15. GPS
Несколько вариантов подключения:

USB:

Многие USB-«мыши» GPS должны работать на ОС BBN после подключения, что дает им некоторое время для поиска спутников за пределами дома. Холодный запуск может занять около получаса с некоторыми моделями GPS.

Повторно используйте GPS, встроенный в маршрутизатор LTE:

Модемы LTE на маршрутизаторах LTE имеют встроенный GPS. Если вы последовали нашему совету по использованию маршрутизатора с ОС OpenWrt, вы сможете установить на него KPlex (или gpsd) и настроить подключение к нему из SignalK (или / и OpenCPN, AvNav), запущенного на вашем raspberry pi.

NMEA:

Используйте GPS из вашей сети NMEA. VHF имеет интерфейсы GPS и NMEA. Некоторые мультиплексоры NMEA поставляются со встроенным GPS, как и большинство картплоттеров.

Платы PCB, подключенные к Pi:

Пример: BerryGPS. Недостатком их является то, что они используют встроенный UART вашего Pi, и у вас могут быть другие устройства, которые вы хотите использовать вместо этого.

2.16. SDR, SSB
RTL-SDR, SDRPlay SDR, HackRF SDR, LimeSDR и другие, вероятно, другие. Интерфейсы USB, Ethernet.

Yaesu, Icom - популярные производители в сообществе HAM.

SDR потребляют довольно много энергии, поэтому лучше подключать их к Pi через USB-концентратор с питанием (в случае USB-интерфейса).

2.17. SSD
ОС Raspberry Pi поддерживает твердотельные накопители NVMe и SATA с соответствующей платой расширения или корпусом Pi и драйвером их поставщика.

NVMe, по-видимому, не дает большого повышения производительности по сравнению с SATA для pi4, за исключением CM4 (вычислительный модуль Pi4), который лучше работает при записи с помощью дисков NVMe. Внутренний интерфейс pi4 является узким местом для скорости передачи данных.

Загрузка с накопителей NVMe недавно была поддержана ядром linux на pi4 (некоторые ошибки могут остаться).

Проведите тест вашего SSD после установки с правильными драйверами. Убедитесь, что он находится в ожидаемом диапазоне.

SSD также менее подвержен повреждению данных при внезапном отключении питания, чем SD-карты.

Производительность USB-накопителей (флешек) не так высока, как у твердотельных накопителей NVMe и SATA.

2.18. NavTex
NASA Marine PC Navtex USB с антенной (для этого в BBN OS входит программа PC-NavTex). ~ 220 $

USB-устройства с сайта wetterinfobox.com (WIB2 - NAVTEX для ПК) http://www.wetterinfobox.com

2.19. RTC (часы реального времени)
Raspberry pi не имеет модуля часов, чтобы отслеживать время, когда он выключен, поэтому вы можете подумать о его добавлении.

Есть несколько распространенных модулей i2c RTC:

DS3231 RTC

DS1307 RTC

Убедитесь, что нет конфликтов адресов с другими вашими устройствами i2c. У других устройств обычно есть хотя бы один вариант переключения на другой адрес, чтобы избежать конфликтов.

2.20. Звуковые карты
Поскольку Raspberry Pi не имеет аудиовхода, для использования с радио SSB вам может потребоваться дополнительная звуковая карта, которая имеет как вход, так и выход звука. Есть хороший выбор вариантов, но проверьте отзывы и совместимость с Raspberry Pi4.

2.21. Камеры
2.21.1. IP камеры
IP-камеры должны работать с MotionEye, используя их URL-адреса rtsp: //.

2.21.2. Подключение камер к CSI на raspberry pi
Geekworm Raspberry Pi Hdmi-in Module, Hdmi to CSI-2 может использоваться для решения проблемы расстояния с камерами CSI.

https://geekworm.com/products/raspberry-pi-hdmi-to-csi-2-adapter-board-with-15-pin-ffc-cable

Еще одна уловка с удлинением кабеля от Arducam CSI к HDMI заключается в том, что камеры CSI могут подключаться к raspberry pi через более длинный HDMI. Вы не можете использовать камеру HDMI, HDMI используется просто как расширение проводного сигнала для CSI.

https://www.arducam.com/product/arducam-csi-hdmi-cable-extension-module-15pin-60mm-fpc-cable-raspberry-pi-camera-specific-pack-2-1-set/

2.21.3. Зрение при слабом освещении
У Sionyx есть несколько решений, ориентированных на катание на лодках: https://www.sionyx.com/pages/boating

Стабилизация изображения при движении лодки также является важным фактором.

Ночное видение FLIR
Хотя камеры FLIR (от компании, которая купила крупного производителя Raymarine) великолепны, они непомерно дороги для большинства яхтсменов-любителей.

2.21.4. Камеры с подключением через USB
Поддерживается USB 3.0

Нам нужна ваша помощь в тестировании, составлении рекомендаций по моделям и т. Д.

2.22. ESP32 / Ардуино
Используя контроллеры ESP32 и немного программирования на микропитоне, вы можете подключать к своей системе все виды датчиков. Одна из понравившихся нам продуктовых линеек - от m5stack.com, а другая - Wio Terminal от seeedstudio.com.

M5Tough: https://shop.m5stack.com/products/m5stack-tough-esp32-iot-development-board-kit.

Вот идея трекера местоположения лодки. https://www.seeedstudio.com/LoRa-GPS-Tracker-with-Wio-Terminal-p-5182.html (Требуется некоторая работа над водонепроницаемым корпусом для передатчика и сообщение местоположения лодки через поток данных AIS NMEA на картплоттер материнского корабля).

2.23. ESP32 с SignalK
Чтобы запрограммировать ESP32 для связи с SignalK, вы можете использовать библиотеку SignalK SensESP: https://github.com/SignalK/SensESP

SensESP позволяет подключать множество датчиков:

Обороты двигателя

Температура двигателя, давление масла

Уровни жидкости (топливо, пресная вода, черная вода, септик)

Окружающая среда (температура, давление, влажность, качество воздуха)

Опасные газы

Удары молнии

Напряжение, амперы

Реле для управления (свет, приборы)

Энергопотребление (мониторинг батарей)

Датчики движения

Обнаружение сердцебиения человека

Счетчики якорных цепей брашпилей

Трюмный насос

Близость

Распознавание отпечатков пальцев

Светлый

Обнаружение цвета

Радиоприемники 433 МГц

Приемники / передатчики LoRa

Интерфейсы (USB, Ethernet, CAN Bus, RS-485, RS-232, 4G / LTE, GPS / GNSS, ModBus и т. Д.)

IMU (гироскоп, магнитометр, акселерометр)

эффект Холла

Приводы, сервопривод, управление двигателем

Аудио (динамик, микрофон), зуммеры

Считыватели штрих-кодов

Считыватели внешней памяти (TF-карта и т. Д.)

Лазерные излучатели / приемники

NCIR / IR приемники / передатчики

Тепловизионные камеры

Джойстик

ЦАП / АЦП

Потенциометры

Концентрация алкоголя в крови

Кислород крови, оксиметр

и больше

2.24. 1-проводной
Плагин SignalK Raspberry Pi 1wire поддерживает подключение нескольких однопроводных датчиков температуры DS18B20.

2.25. Интернет вещей
Коммутаторы Sonoff - поддерживаются плагином SignalK.

Датчики погоды Ecowitt - поддерживаются через плагин SignalK.

Selly https://shelly.cloud/ - поддерживается через плагин SignalK.

EmpirBus NXT https://www.empirbus.com/ - поддерживается через плагин SignalK.

2.26. Преобразователи питания, 12в → 5в
2.26.1. Преобразователи постоянного напряжения
Этот конвертер использовался без проблем:

TOBSUN EA50-5V DC 12 В 24 В в DC 5 В 10A 50 Вт преобразователь регулятор 5 В 50 Вт источник питания понижающий модуль трансформатор

Автоматическая защита от перенапряжения, перегрузки по току, перегрева, короткого замыкания
Входное напряжение: 12/24 В, выход: 5 В / 10 А
https://www.amazon.com/dp/B01M03288J

​

А также этот УБЭК:

US Ship Hobbywing 5V / 6V 3A Switch-mode UBEC, макс. 5A, самый низкий уровень радиочастот

https://www.amazon.com/dp/B008ZNWOYY

Избегайте подачи питания на Pi4 напрямую через контакты GPIO, поскольку он обходит самовосстанавливающийся предохранитель перенапряжения, встроенный в пи.

2.26.2. Управление питанием, Victron, Venus OS
SignalK имеет хорошую поддержку взаимодействия с продуктами Victron Energy и их ОС Venus.

SignalK поставляется с:

Плагин Victron Venus OS

Плагин клиента ModBus

2.27. Проекты открытых лодок
Открытые проекты лодок: https://open-boat-projects.org/en/

2.28. Антенны
Разнообразие антенн лодки великое. Направленный против всенаправленного, активный против пассивного, внутренний (некоторые из них являются лишь частью цепи на печатной плате) против внешнего, заземленный против незаземленного, только прием против приема / передачи и широкий спектр форм.

2.28.1. УКВ, АИС
VHF и AIS используют одинаковые частоты, они должны находиться в прямой видимости, поэтому чем выше они, тем лучше. Они ограничены кривизной Земли. Диапазон составляет около 30 миль. Они могут использовать ту же антенну с соответствующим разветвителем. Передающее устройство в AIS должно быть лицензировано и зарегистрировано.

2.28.2. Wi-Fi, LTE / 4G
Похожие, но разные отдельные антенны. Может работать даже в каюте лодки из стеклопластика. Диапазон зависит от усиления антенны. Wi-Fi обычно в сотнях футов. LTE / 4G на расстоянии / менее нескольких миль. LTE / 4G использует сотовую сеть антенн сетевых провайдеров, которая покрывает большинство населенных пунктов.

2.28.3. GPS
Только для приема. Не обязательно быть под кайфом. Требуется беспрепятственный обзор нескольких спутников. Внешние обычно активны и помещены внутрь пластика, похожего на гриб. Предназначен для покрытия практически по всему миру (за исключением районов крайних северных и южных полюсов). Существует несколько систем GNSS с разными группировками спутников. GPS (США), BEIDOU (Китай), GALILEO (ЕС), ГЛОНАСС (Россия) и QZSS (Япония)

2.28.4. Спутниковые данные (Iridium, StarLink и т. Д.)
Оба имеют спутниковую связь. Iridium разработан для портативного телефона с небольшой антенной. StarLink обменивается данными с большим количеством спутников на гораздо более низких орбитах, и он разработан для направленной тарелочной антенны размером с пиццу, автоматически ориентирующейся с помощью двигателя. Предназначен для покрытия практически по всему миру (за исключением районов крайних северных и южных полюсов).

Поставщики спутниковых данных:

Иридий

Orbcomm

Инмарсат

Глобалстар

StarLink

Рой

Другие тоже

2.28.5. FM (частотная модуляция)
Короткий кусок провода, маленькая телескопическая антенна. Только получать. Диапазон 30-40 миль. Передается с наземных станций. VHF - это тоже FM, но FM - это вольно используемый термин для обозначения музыкальных и местных новостных каналов.

2.28.6. Bluetooth, 433 МГц FM RF
Антенны Bluetooth небольшие и часто являются частью печатной платы. Радиус действия Bluetooth действительно невелик и составляет около 10 метров.

Диапазон 433 МГц FM RF составляет около 300 метров. Часто используется для пультов дистанционного управления. Беспроводные топовые датчики ветра и т. Д.

2.28.7. NavTex, WeatherFax
Только получать. Передается с наземных станций с заранее заданными интервалами времени. Частота использования WeatherFax зависит от региона. Вам необходимо знать расписание передающих станций WeatherFax для разных регионов.

Частота NavTex составляет 518 кГц в среднем диапазоне частот. 490 кГц дополнительно в некоторых странах. И NavTex, и WeatherFax предназначены для работы практически по всему миру и для морских путешествий.

Активная мини-штыревая антенна PA0RDT подходит для частот NavTex и WeatherFax: http://dl1dbc.net/SAQ/miniwhip.html

2.28.8. SSB, HAM
Для передачи по радио SSB (Single Side Band) требуется лицензия для оператора, за исключением экстренных случаев. Предназначен для дальней связи на море и для оффшорных судов. Изолированный ахтерштаг мачты может служить SSB антенной. Распространение радиоволн SSB происходит при отражении или преломлении обратно к Земле от ионосферы. Диапазон производительности превышает 4000 миль. Некоторые части частотного спектра SSB лучше работают ночью, другие - днем.

Радиолюбительская (или любительская) радиосвязь также требует наличия у оператора лицензии на передачу.

2.28.9. LoRa
Радио LoRa (Long Range) не требует лицензии как на передачу, так и на прием. Дальность 2-5 км на открытой местности. Используется в качестве беспроводной платформы с низким энергопотреблением (и низкой пропускной способностью трафика) для Интернета вещей (IoT). Антенны LoRa небольшие и обычно прикрепляются к его устройствам.

3. Как вы можете помочь
Добавьте звезду на нашу страницу проекта github https://github.com/bareboat-necessities/lysmarine_gen

Сообщите об ошибке (или внесите свой вклад в решение существующей проблемы) https://github.com/bareboat-necessities/lysmarine_gen/issues

Распространить слово. В Интернете и на Facebook есть много форумов по парусному спорту. Расскажите другим людям, что BBN OS может для вас сделать.

Ответьте на вопрос на наших дискуссионных форумах: https://github.com/bareboat-necessities/lysmarine_gen/discussions

Разместите на YouTube видео, объясняющее, как вы используете BBN OS на своей лодке.

Отправьте запрос на перенос на github с изменениями кода для улучшения ОС BBN

Разместите статью в блоге или внесите свой вклад в раздел HOWTO этого документа.

Конечно, ОС BBN полностью открыта и бесплатна.

4. HOWTO
Отправьте нам свое практическое руководство, и мы сможем добавить его сюда, чтобы каждый мог найти его. Спасибо

4.1. BerryGPS-IMU V3
Устанавливаем шапку BerryGPS-IMU V3

Следуйте инструкциям, чтобы включить i2c и отключить последовательный порт https://ozzmaker.com/berrygps-setup-guide-raspberry-pi/

Удалите последовательную консоль, указанную в /boot/cmdline.txt (аргумент с serial0 и скоростью передачи)

Перезагрузить

sudo i2cdetect -y 1 (должен показать вам адреса)

Создайте соединение pypilot с signalK (см. Https://bareboat-necessities.github.io/my-bareboat/bareboat-os.html#_imu )

Настройте подачу барометра из SignalK ( https://bareboat-necessities.github.io/my-bareboat/bareboat-os.html#_barometer_tempera_humidity )

Заголовок данных IMU и т. Д. Должен поступать из Pypilot NMEA

проверьте это с помощью telnet localhost 20220

Краткое объяснение:

i2c должен быть включен, последовательная консоль отключена в config.txt

Драйвер i2c должен быть загружен при загрузке (это то, что делает шаг raspi-config)

На этом этапе у вас должны быть данные, считываемые с GPS (через / dev / serial0) и IMU / барометра (через i2c).

Теперь вы настроили маршрутизацию этих данных в дашборды, картплоттеры.

IMU считывается pypilot, который передает его через порт 20220 tcp в формате NMEA 0183.

pypilot также должен иметь подключение через веб-сокет SignalK к порту 3000 signalK.

Это соединение необходимо авторизовать, сделайте ЧТЕНИЕ / ЗАПИСЬ в signalK, используя их процедуру обмена токенами.

GPS считывается с помощью signalK путем создания подключения NMEA к порту / dev / serial0 (установите правильную скорость передачи)

Данные о барометрическом / температурном давлении считываются SignalK с помощью плагина signalK BME280. Убедитесь, что установлен интервал опроса менее 30 секунд (поскольку OpenCPN истекает не навигационные данные каждые 30 секунд)

Откалибруйте IMU уровня по воде. Откалибруйте свой компас IMU с помощью калибровочной утилиты pyPilot.

Я использую с ним внешнюю GPS-антенну. (Это должна быть активная антенна). На плате Berry есть перемычка / переключатель для выбора внешней антенны.

Антенна сотовой связи, GPS, Wi-Fi (3 в одном), модель AFCJF3, цена 80 долл. США Предназначенная для морских и прогулочных транспортных средств (RV), эта многодиапазонная антенна для сотовой связи, GPS и Wi-Fi (696 МГц - 5900 МГц / 5,9 ГГц) представляет собой 3 всенаправленная водонепроницаемая антенна со степенью защиты IP67 для связи в суровых условиях окружающей среды. https://www.signalbooster.com/products/cellular-gps-wifi-antenna
Проверьте с помощью команд:

sudo i2cdetect -y 1
должен показать адреса в автобусе, тогда

systemctl status pypilot @ pypilot
должен показать, что служба pypilot включена, работает и не имеет ошибок.

Telnet localhost 20220
должен показывать поток заголовочных данных NMEA от pypilot.

telnet localhost 10110
должен отображать предложения GPS и заголовка NMEA от SignalK.

Также ознакомьтесь с часто задаваемыми вопросами, касающимися berryGPS:

https://ozzmaker.com/berrygps_imu-faq/

Может потребоваться отключение эха на последовательном порту, а также включение временного предложения ZDA NMEA.

Приемники ublox GPS имеют обширную конфигурацию. Проверить: https://gpsd.io/ubxtool-examples.html

4.2. RTL8812AU драйверы
Следуя этим шагам, он отлично скомпилировался с первой попытки https://github.com/aircrack-ng/rtl8812au

Также есть скрипт для установки различных дополнительных драйверов для WiFi карт.

cd /home/user/add-ons
./wifi-drivers-install.sh
4.3. Облачное хранилище
Используя rclone, вы можете хранить и синхронизировать свои файлы в хранилищах многих облачных поставщиков. Подробнее: https://github.com/rclone/rclone

4.4. Использование вашего смартфона в качестве приемника NMEA GPS
Установите приложение GPS2IP на свой смартфон. Запустите его и включите в нем GPS2IP. Ваш телефон должен быть в той же локальной сети, что и ваш лодочный компьютер. В SignalK добавьте соединение gps2ip_on_smartphone NMEA TCP к IP-адресу, указанному в приложении GPS2IP, и указанному там порту (обычно 11123). IP-адрес вашего телефона должен быть статическим. Поэтому убедитесь, что он сопоставлен со статическим адресом в ваших сетях WiFi с MAC-адресом вашего телефона.

4.5. Как пользоваться смартфоном в качестве GPS-приемника и иметь доступ в Интернет на лодке в пределах сотовой связи
Если у вас есть смартфон на борту, вы можете использовать его в качестве источника данных NMEA GPS и Интернет-провайдера для всех ваших лодочных устройств, подключенных к вашему лодочному компьютеру.

Следуйте инструкциям. Использование iPhone в качестве Интернет-шлюза (или Использование телефона Android в качестве Интернет-шлюза ) для подключения к телефону и использования его в качестве точки доступа в Интернет.

Следуйте инструкциям. Использование смартфона в качестве приемника GPS NMEA для использования GPS телефона в качестве источника данных GPS NMEA 0183.

4.6. Настройка двух мониторов
Raspberry Pi имеет два выхода HDMI. Однако его программное обеспечение по-прежнему не может должным образом обрабатывать два разнородных дисплея. Самый сложный случай - это когда один сенсорный экран, а другой - нет, и у них разные разрешения экрана, и подключенная мышь, которая должна перемещаться из одного рабочего пространства экрана в другое рабочее пространство вторичного экрана. Еще одна проблема - во время загрузки. Что делать, если на один экран подается питание, а на другой - нет, но пользователь решает включить второй экран позже. ОС Raspberry Pi, похоже, не может охватить все эти сценарии (как и другие дистрибутивы Linux в текущем состоянии).

4.7. Автозапуск программ при запуске рабочего стола
Вы можете настроить, какие программы должны запускаться автоматически при открытии рабочего стола, в Администрирование → Настройки рабочего стола Budgie. Многие пользователи, вероятно, сразу захотят OpenCPN и KIP Dashboard.

4.8. Работа с мониторами с более высоким разрешением
С мониторами с более высоким разрешением вы можете настроить размер шрифта и элементы пользовательского интерфейса, чтобы они были больше на вашем экране.

Зайдите в Администрирование / Настройки / Универсальный доступ.

Включите «Крупный текст», установите для параметра «Размер курсора» значение «Средний».

В OpenCPN перейдите в Инструменты / Параметры / Пользовательский интерфейс.

Установите ползунок User Intrface Scale Factor (и все остальные ползунки) на 1

Нажмите "ОК", чтобы применить настройки.

4.9. Сторожевая собака
Raspberry Pi имеет встроенное оборудование, которое позволяет автоматически перезагружаться в случае зависания.

Чтобы включить эту функцию, вам необходимо добавить:

RuntimeWatchdogSec=10
ShutdownWatchdogSec=5min
в /etc/systemd/system.conf, перезагрузитесь, затем проверьте сторожевой таймер:

systemctl show | grep -i watchdog
dmesg | grep watchdog
RuntimeWatchdogUSec=10s
ShutdownWatchdogUSec=5min
ServiceWatchdogs=yes
[ 3.125165] bcm2835-wdt bcm2835-wdt: Broadcom BCM2835 watchdog timer
[ 5.200029] systemd[1]: Hardware watchdog 'Broadcom BCM2835 Watchdog timer', version 0
[ 5.206438] systemd[1]: Set hardware watchdog to 10s.
Тестировать:

sudo su
echo 1 > /proc/sys/kernel/sysrq
echo "c" > /proc/sysrq-trigger
Подробнее здесь: https://pysselilivet.blogspot.com/2021/10/raspberry-pi-watchdog-made-simple.html

4.10. Устранение неполадок / dev / ttyXXXX устройство или ресурс занят
Если вы получили это сообщение, скорее всего, это другой процесс, открывший / dev / ttyXXXX. Чтобы выяснить источник конфликта, вы можете использовать:

sudo lsof /dev/ttyXXXX
